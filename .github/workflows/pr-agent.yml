name: PR Review Bot

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v3

      - name: Disparar PRâ€‘Agent via HTTP
        env:
          REPO: https://github.com/${{ github.repository }}.git
          PR: ${{ github.event.pull_request.number }}
          TOKEN: ${{ github.token }}
          AGENT_URL: https://484b-204-199-57-14.ngrok-free.app/analyze
        run: |
          echo "ðŸ”” Chamando PRâ€‘Agent para o PR #${PR} em ${REPO}..."
          curl -sSL \
            -X POST "$AGENT_URL" \
            -H "Content-Type: application/json" \
            -d '{
                  "repo_url": "'"${REPO}"'",
                  "pr_number": '"${PR}"',
                  "github_token": "'"${TOKEN}"'",
                }' \
          | tee pr_agent_response.json

      - name: Mostrar resposta do PRâ€‘Agent
        run: |
          echo "ðŸ“‹ Feedback do agente:"
          cat pr_agent_response.json
